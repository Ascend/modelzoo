# LeNet网络迁移

```shell
网络源码路径：https://github.com/Jackpopc/aiLearnNotes/blob/master/computer_vision/LeNet.py 
```

### 1、模型概述：

LeNet 用于文本识别

##### 注：该网络基于20210304主线newest版本迁移。 

### 2、数据集：

名称：MNIST

路径：` 10.136.165.4服务器:/turingDataset/MNIST路径`

### 3、依赖安装: 

`requirements.txt随网络模型归档至gitlab仓。`

```shell
tensorflow==1.15.0
```

### 4、训练详细调测步骤：

#### 1、数据集预处理：

路径：` 10.136.165.4服务器:/turingDataset/MNIST路径`

#### 2、训练命令：

```shell
python3 LeNet.py
```

封装后：

```
bash run_1p.sh
```

#### 3、NPU训练结果：

##### `ckpt_npu`文件存放路径：

` 10.136.165.4服务器:/turingDataset/results/CarPeting_TF_LeNet路径`

```shell
精度性能示例：
epoch : 0----loss : 2.623750925064087----step/sec : 7.003568410873413
epoch : 0----loss : 2.5470128059387207----step/sec : 0.007029056549072266
epoch : 0----loss : 2.394474983215332----step/sec : 0.0065364837646484375
epoch : 0----loss : 2.4076855182647705----step/sec : 0.006308794021606445
epoch : 0----loss : 2.402376890182495----step/sec : 0.006328582763671875
epoch : 0----loss : 2.3880505561828613----step/sec : 0.00619816780090332
epoch : 0----loss : 2.301079273223877----step/sec : 0.0062274932861328125
epoch : 0----loss : 2.4007773399353027----step/sec : 0.006306648254394531
epoch : 0----loss : 2.36064076423645----step/sec : 0.00623774528503418
epoch : 0----loss : 2.328463077545166----step/sec : 0.006319761276245117
epoch : 0----loss : 2.330557346343994----step/sec : 0.00629115104675293
epoch : 0----loss : 2.360325336456299----step/sec : 0.006252765655517578
epoch : 0----loss : 2.315668821334839----step/sec : 0.006254911422729492
epoch : 0----loss : 2.3049728870391846----step/sec : 0.006815910339355469
epoch : 0----loss : 2.315520763397217----step/sec : 0.006221294403076172
epoch : 0----loss : 2.2970900535583496----step/sec : 0.0062160491943359375
epoch : 0----loss : 2.334798812866211----step/sec : 0.006212949752807617
epoch : 0----loss : 2.297126531600952----step/sec : 0.006218433380126953
epoch : 0----loss : 2.326735496520996----step/sec : 0.0062978267669677734
epoch : 0----loss : 2.315764904022217----step/sec : 0.006324052810668945
epoch : 0----loss : 2.3710289001464844----step/sec : 0.006342649459838867
epoch : 0----loss : 2.356638193130493----step/sec : 0.0061953067779541016
...

epoch : 4----loss : 0.15936142206192017----step/sec : 0.006265163421630859
epoch : 4----loss : 0.14052502810955048----step/sec : 0.006222248077392578
epoch : 4----loss : 0.04300885275006294----step/sec : 0.006245851516723633
epoch : 4----loss : 0.013601601123809814----step/sec : 0.006235599517822266
epoch : 4----loss : 0.026478728279471397----step/sec : 0.0062329769134521484
epoch : 4----loss : 0.04682954400777817----step/sec : 0.006174564361572266
epoch : 4----loss : 0.03224445879459381----step/sec : 0.006216287612915039
epoch : 4----loss : 0.03924068436026573----step/sec : 0.0062007904052734375
epoch : 4----loss : 0.0275897104293108----step/sec : 0.0062253475189208984
epoch : 4----loss : 0.030324162915349007----step/sec : 0.00623774528503418
epoch : 4----loss : 0.02288416400551796----step/sec : 0.006239175796508789
epoch : 4----loss : 0.022501694038510323----step/sec : 0.006234645843505859
epoch : 4----loss : 0.06144321337342262----step/sec : 0.006228446960449219
epoch : 4----loss : 0.06588464975357056----step/sec : 0.006207466125488281
epoch : 4----loss : 0.07116927951574326----step/sec : 0.006268024444580078
epoch : 4----loss : 0.18488344550132751----step/sec : 0.006271839141845703
epoch : 4----loss : 0.04592322185635567----step/sec : 0.006262063980102539
epoch : 4----loss : 0.054096437990665436----step/sec : 0.006233930587768555
epoch : 4----loss : 0.02555731125175953----step/sec : 0.006203413009643555
epoch : 4----loss : 0.07133384048938751----step/sec : 0.006264925003051758
epoch : 4----loss : 0.020435035228729248----step/sec : 0.006219148635864258
epoch : 4----loss : 0.021149972453713417----step/sec : 0.006277799606323242
epoch : 4----loss : 0.016011852771043777----step/sec : 0.006205081939697266

```

#### 4、GPU训练结果：

##### 环境：Tesla V100卡 

##### `ckpt_gpu`文件，`loss+perf_gpu.txt`存放路径：

` 10.136.165.4服务器:/turingDataset/GPU/CarPeting_TF_LeNet路径`

```shell
精度性能示例：
epoch : 0----loss : 2.4991092681884766----step/sec : 1.7635548114776611
epoch : 0----loss : 2.687896490097046----step/sec : 0.027411937713623047
epoch : 0----loss : 2.4108572006225586----step/sec : 0.01569199562072754
epoch : 0----loss : 2.518103837966919----step/sec : 0.015290260314941406
epoch : 0----loss : 2.551788568496704----step/sec : 0.016294002532958984
epoch : 0----loss : 2.389204978942871----step/sec : 0.015699148178100586
epoch : 0----loss : 2.3462042808532715----step/sec : 0.015414237976074219
epoch : 0----loss : 2.378295660018921----step/sec : 0.015264034271240234
epoch : 0----loss : 2.2845799922943115----step/sec : 0.015371322631835938
epoch : 0----loss : 2.3309507369995117----step/sec : 0.015331506729125977
epoch : 0----loss : 2.3219070434570312----step/sec : 0.011043787002563477
epoch : 0----loss : 2.3189663887023926----step/sec : 0.011188507080078125
epoch : 0----loss : 2.307332992553711----step/sec : 0.0065441131591796875
epoch : 0----loss : 2.3238449096679688----step/sec : 0.006568431854248047
epoch : 0----loss : 2.2951302528381348----step/sec : 0.0016045570373535156
epoch : 0----loss : 2.3063788414001465----step/sec : 0.0015919208526611328
epoch : 0----loss : 2.322862148284912----step/sec : 0.0016126632690429688
epoch : 0----loss : 2.2939062118530273----step/sec : 0.0015912055969238281
...
epoch : 4----loss : 0.14667147397994995----step/sec : 0.00157928466796875
epoch : 4----loss : 0.11478888988494873----step/sec : 0.0015954971313476562
epoch : 4----loss : 0.05526713654398918----step/sec : 0.0018796920776367188
epoch : 4----loss : 0.0673222541809082----step/sec : 0.001598358154296875
epoch : 4----loss : 0.006661318242549896----step/sec : 0.0019948482513427734
epoch : 4----loss : 0.09877638518810272----step/sec : 0.0016148090362548828
epoch : 4----loss : 0.06008529290556908----step/sec : 0.0016188621520996094
epoch : 4----loss : 0.018361221998929977----step/sec : 0.0015838146209716797
epoch : 4----loss : 0.12218349426984787----step/sec : 0.001954793930053711
epoch : 4----loss : 0.07719817012548447----step/sec : 0.001592397689819336
epoch : 4----loss : 0.05415574461221695----step/sec : 0.0015904903411865234
epoch : 4----loss : 0.1383344829082489----step/sec : 0.0019807815551757812
epoch : 4----loss : 0.024562587961554527----step/sec : 0.0015780925750732422
epoch : 4----loss : 0.0690770149230957----step/sec : 0.0019745826721191406
epoch : 4----loss : 0.01827675849199295----step/sec : 0.0015935897827148438
epoch : 4----loss : 0.17556753754615784----step/sec : 0.0019614696502685547
epoch : 4----loss : 0.02113041654229164----step/sec : 0.001941680908203125


```

#### 5、GPU/NPU loss收敛趋势：

| epoch | GPU loss            | NPU loss             |
| :---- | ------------------- | :------------------- |
| 0     | 0.22310571372509003 | 0.21254456043243408  |
| 1     | 0.08628739416599274 | 0.1061868891119957   |
| 2     | 0.07969710230827332 | 0.10638656467199326  |
| 3     | 0.05494418367743492 | 0.1299923211336136   |
| 4     | 0.02113041654229164 | 0.016011852771043777 |

#### 6、单step耗时 NPU/GPU：

```shell
NPU/GPU=0.0062/0.0018
```

