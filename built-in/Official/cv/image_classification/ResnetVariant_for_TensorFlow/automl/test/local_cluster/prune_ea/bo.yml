general:
    task:
        local_base_path: /efs-hn/cache/local/
        backup_base_path: 
    worker:
        devices_per_job: 2

pipeline: [hpo1]

hpo1:
    pipe_step:
        type: HpoPipeStep

    dataset:
        type: Cifar10

    hpo:
        type: BoHpo
        total_epochs: 1
        config_count: 40
        warmup_count: 5
        alg_name: SMAC
        hyperparameter_space:
            hyperparameters:
                - key: dataset.batch_size
                  type: INT_CAT
                  range: [8, 16, 32, 64, 128, 256]
                - key: trainer.optim.lr
                  type: FLOAT_EXP
                  range: [0.00001, 0.1]
                - key: trainer.optim.type
                  type: STRING
                  range: ['Adam', 'SGD']
                - key: trainer.optim.momentum
                  type: FLOAT
                  range: [0.0, 0.99]
            condition:
                - key: condition_for_sgd_momentum
                  child: trainer.optim.momentum
                  parent: trainer.optim.type
                  type: EQUAL
                  range: ["SGD"]

    trainer:
        type: Trainer
        load_checkpoint: True
        with_valid: False
        cuda: False
        report_freq: 50
        epochs: 1
        model_desc:
            modules: ["backbone", "head"]
            backbone:
                base_channel: 64
                downsample: [1, 0, 1, 0, 0, 0, 1, 0]
                base_depth: 18
                doublechannel: [1, 0, 1, 0, 0, 0, 1, 0]
                name: ResNetVariant
            head:
                num_classes: 10
                name: LinearClassificationHead
                base_channel: 512
        optim:
            type: Adam
            lr: 0.1
        lr_scheduler:
            type: MultiStepLR
            milestones: [75, 150]
            gamma: 0.5
        metric:
            type: accuracy
        loss:
            type: CrossEntropyLoss

    evaluator:
        type: Evaluator
        gpu_evaluator:
            type: GpuEvaluator
            load_checkpoint: True
            cuda: False
            batch_size: 128
            optim:
                type: Adam
                lr: 0.1
            lr_scheduler:
                type: MultiStepLR
                milestones: [75, 150]
                gamma: 0.5
            loss:
                type: CrossEntropyLoss
            metric:
                type: accuracy
        # dloop_evaluator:
        #     type: DLoopEvaluator
